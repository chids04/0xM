---
import { app } from "../firebase/server";
import { getAuth } from "firebase-admin/auth";
import { getFirestore } from "firebase-admin/firestore"
import Layout from "../layouts/Navbar.astro";
import "../styles/global.css";
import WalletCreationModal from "@/components/WalletCreationModal.astro";

const auth = getAuth(app);
const db = getFirestore(app);

const sessionCookie = Astro.cookies.get("__session")?.value;

if (!sessionCookie) {
  return Astro.redirect("/signin");
}

let user = null

try {
  const decodedCookie = await auth.verifySessionCookie(sessionCookie);
  
  user = await auth.getUser(decodedCookie.uid);
  if (!user) {
    return Astro.redirect("/signin");
  }

} catch (error) {
  console.error("Error verifying session cookie:", error);
  return Astro.redirect("/signin");
}



---

<Layout title="dashboard">
  <h1 class="text-3xl font-bold underline">Welcome {user.displayName}</h1>
  <p>We are happy to see you here</p>
  <form action="/api/auth/signout">
    <button type="submit">Sign out</button>
  </form>
  <WalletCreationModal user = {user.uid}></WalletCreationModal>
</Layout>

<script>
  
  
</script>



